package graphapi

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen

import (
	"context"

	"github.com/rs/zerolog/log"
	"github.com/theopenlane/core/internal/ent/generated"
	"github.com/theopenlane/core/internal/graphapi/model"
)

// APITokenSearch is the resolver for the apiTokenSearch field.
func (r *queryResolver) APITokenSearch(ctx context.Context, query string) (*model.APITokenSearchResult, error) {
	apitokenResults, err := searchAPITokens(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.APITokenSearchResult{
		APITokens: apitokenResults,
	}, nil
}

// ActionPlanSearch is the resolver for the actionPlanSearch field.
func (r *queryResolver) ActionPlanSearch(ctx context.Context, query string) (*model.ActionPlanSearchResult, error) {
	actionplanResults, err := searchActionPlans(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.ActionPlanSearchResult{
		ActionPlans: actionplanResults,
	}, nil
}

// ContactSearch is the resolver for the contactSearch field.
func (r *queryResolver) ContactSearch(ctx context.Context, query string) (*model.ContactSearchResult, error) {
	contactResults, err := searchContacts(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.ContactSearchResult{
		Contacts: contactResults,
	}, nil
}

// ControlSearch is the resolver for the controlSearch field.
func (r *queryResolver) ControlSearch(ctx context.Context, query string) (*model.ControlSearchResult, error) {
	controlResults, err := searchControls(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.ControlSearchResult{
		Controls: controlResults,
	}, nil
}

// ControlObjectiveSearch is the resolver for the controlObjectiveSearch field.
func (r *queryResolver) ControlObjectiveSearch(ctx context.Context, query string) (*model.ControlObjectiveSearchResult, error) {
	controlobjectiveResults, err := searchControlObjectives(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.ControlObjectiveSearchResult{
		ControlObjectives: controlobjectiveResults,
	}, nil
}

// DocumentDataSearch is the resolver for the documentDataSearch field.
func (r *queryResolver) DocumentDataSearch(ctx context.Context, query string) (*model.DocumentDataSearchResult, error) {
	documentdataResults, err := searchDocumentData(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.DocumentDataSearchResult{
		DocumentData: documentdataResults,
	}, nil
}

// EntitySearch is the resolver for the entitySearch field.
func (r *queryResolver) EntitySearch(ctx context.Context, query string) (*model.EntitySearchResult, error) {
	entityResults, err := searchEntities(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.EntitySearchResult{
		Entities: entityResults,
	}, nil
}

// EntityTypeSearch is the resolver for the entityTypeSearch field.
func (r *queryResolver) EntityTypeSearch(ctx context.Context, query string) (*model.EntityTypeSearchResult, error) {
	entitytypeResults, err := searchEntityTypes(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.EntityTypeSearchResult{
		EntityTypes: entitytypeResults,
	}, nil
}

// EventSearch is the resolver for the eventSearch field.
func (r *queryResolver) EventSearch(ctx context.Context, query string) (*model.EventSearchResult, error) {
	eventResults, err := searchEvents(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.EventSearchResult{
		Events: eventResults,
	}, nil
}

// FileSearch is the resolver for the fileSearch field.
func (r *queryResolver) FileSearch(ctx context.Context, query string) (*model.FileSearchResult, error) {
	fileResults, err := searchFiles(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.FileSearchResult{
		Files: fileResults,
	}, nil
}

// GroupSearch is the resolver for the groupSearch field.
func (r *queryResolver) GroupSearch(ctx context.Context, query string) (*model.GroupSearchResult, error) {
	groupResults, err := searchGroups(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.GroupSearchResult{
		Groups: groupResults,
	}, nil
}

// GroupSettingSearch is the resolver for the groupSettingSearch field.
func (r *queryResolver) GroupSettingSearch(ctx context.Context, query string) (*model.GroupSettingSearchResult, error) {
	groupsettingResults, err := searchGroupSettings(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.GroupSettingSearchResult{
		GroupSettings: groupsettingResults,
	}, nil
}

// IntegrationSearch is the resolver for the integrationSearch field.
func (r *queryResolver) IntegrationSearch(ctx context.Context, query string) (*model.IntegrationSearchResult, error) {
	integrationResults, err := searchIntegrations(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.IntegrationSearchResult{
		Integrations: integrationResults,
	}, nil
}

// InternalPolicySearch is the resolver for the internalPolicySearch field.
func (r *queryResolver) InternalPolicySearch(ctx context.Context, query string) (*model.InternalPolicySearchResult, error) {
	internalpolicyResults, err := searchInternalPolicies(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.InternalPolicySearchResult{
		InternalPolicies: internalpolicyResults,
	}, nil
}

// NarrativeSearch is the resolver for the narrativeSearch field.
func (r *queryResolver) NarrativeSearch(ctx context.Context, query string) (*model.NarrativeSearchResult, error) {
	narrativeResults, err := searchNarratives(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.NarrativeSearchResult{
		Narratives: narrativeResults,
	}, nil
}

// OrgSubscriptionSearch is the resolver for the orgSubscriptionSearch field.
func (r *queryResolver) OrgSubscriptionSearch(ctx context.Context, query string) (*model.OrgSubscriptionSearchResult, error) {
	orgsubscriptionResults, err := searchOrgSubscriptions(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.OrgSubscriptionSearchResult{
		OrgSubscriptions: orgsubscriptionResults,
	}, nil
}

// OrganizationSearch is the resolver for the organizationSearch field.
func (r *queryResolver) OrganizationSearch(ctx context.Context, query string) (*model.OrganizationSearchResult, error) {
	organizationResults, err := searchOrganizations(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.OrganizationSearchResult{
		Organizations: organizationResults,
	}, nil
}

// OrganizationSettingSearch is the resolver for the organizationSettingSearch field.
func (r *queryResolver) OrganizationSettingSearch(ctx context.Context, query string) (*model.OrganizationSettingSearchResult, error) {
	organizationsettingResults, err := searchOrganizationSettings(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.OrganizationSettingSearchResult{
		OrganizationSettings: organizationsettingResults,
	}, nil
}

// PersonalAccessTokenSearch is the resolver for the personalAccessTokenSearch field.
func (r *queryResolver) PersonalAccessTokenSearch(ctx context.Context, query string) (*model.PersonalAccessTokenSearchResult, error) {
	personalaccesstokenResults, err := searchPersonalAccessTokens(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.PersonalAccessTokenSearchResult{
		PersonalAccessTokens: personalaccesstokenResults,
	}, nil
}

// ProcedureSearch is the resolver for the procedureSearch field.
func (r *queryResolver) ProcedureSearch(ctx context.Context, query string) (*model.ProcedureSearchResult, error) {
	procedureResults, err := searchProcedures(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.ProcedureSearchResult{
		Procedures: procedureResults,
	}, nil
}

// ProgramSearch is the resolver for the programSearch field.
func (r *queryResolver) ProgramSearch(ctx context.Context, query string) (*model.ProgramSearchResult, error) {
	programResults, err := searchPrograms(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.ProgramSearchResult{
		Programs: programResults,
	}, nil
}

// RiskSearch is the resolver for the riskSearch field.
func (r *queryResolver) RiskSearch(ctx context.Context, query string) (*model.RiskSearchResult, error) {
	riskResults, err := searchRisks(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.RiskSearchResult{
		Risks: riskResults,
	}, nil
}

// StandardSearch is the resolver for the standardSearch field.
func (r *queryResolver) StandardSearch(ctx context.Context, query string) (*model.StandardSearchResult, error) {
	standardResults, err := searchStandards(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.StandardSearchResult{
		Standards: standardResults,
	}, nil
}

// SubcontrolSearch is the resolver for the subcontrolSearch field.
func (r *queryResolver) SubcontrolSearch(ctx context.Context, query string) (*model.SubcontrolSearchResult, error) {
	subcontrolResults, err := searchSubcontrols(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.SubcontrolSearchResult{
		Subcontrols: subcontrolResults,
	}, nil
}

// SubscriberSearch is the resolver for the subscriberSearch field.
func (r *queryResolver) SubscriberSearch(ctx context.Context, query string) (*model.SubscriberSearchResult, error) {
	subscriberResults, err := searchSubscribers(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.SubscriberSearchResult{
		Subscribers: subscriberResults,
	}, nil
}

// TFASettingSearch is the resolver for the tFASettingSearch field.
func (r *queryResolver) TFASettingSearch(ctx context.Context, query string) (*model.TFASettingSearchResult, error) {
	tfasettingResults, err := searchTFASettings(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.TFASettingSearchResult{
		TFASettings: tfasettingResults,
	}, nil
}

// TaskSearch is the resolver for the taskSearch field.
func (r *queryResolver) TaskSearch(ctx context.Context, query string) (*model.TaskSearchResult, error) {
	taskResults, err := searchTasks(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.TaskSearchResult{
		Tasks: taskResults,
	}, nil
}

// TemplateSearch is the resolver for the templateSearch field.
func (r *queryResolver) TemplateSearch(ctx context.Context, query string) (*model.TemplateSearchResult, error) {
	templateResults, err := searchTemplates(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.TemplateSearchResult{
		Templates: templateResults,
	}, nil
}

// UserSearch is the resolver for the userSearch field.
func (r *queryResolver) UserSearch(ctx context.Context, query string) (*model.UserSearchResult, error) {
	userResults, err := searchUsers(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.UserSearchResult{
		Users: userResults,
	}, nil
}

// UserSettingSearch is the resolver for the userSettingSearch field.
func (r *queryResolver) UserSettingSearch(ctx context.Context, query string) (*model.UserSettingSearchResult, error) {
	usersettingResults, err := searchUserSettings(ctx, query)

	if err != nil {
		return nil, ErrSearchFailed
	}

	// return the results
	return &model.UserSettingSearchResult{
		UserSettings: usersettingResults,
	}, nil
}

// Search is the resolver for the search field.
func (r *queryResolver) Search(ctx context.Context, query string) (*model.SearchResultConnection, error) {
	if len(query) < 3 {
		return nil, ErrSearchQueryTooShort
	}

	var (
		errors                     []error
		apitokenResults            []*generated.APIToken
		actionplanResults          []*generated.ActionPlan
		contactResults             []*generated.Contact
		controlResults             []*generated.Control
		controlobjectiveResults    []*generated.ControlObjective
		documentdataResults        []*generated.DocumentData
		entityResults              []*generated.Entity
		entitytypeResults          []*generated.EntityType
		eventResults               []*generated.Event
		fileResults                []*generated.File
		groupResults               []*generated.Group
		groupsettingResults        []*generated.GroupSetting
		integrationResults         []*generated.Integration
		internalpolicyResults      []*generated.InternalPolicy
		narrativeResults           []*generated.Narrative
		orgsubscriptionResults     []*generated.OrgSubscription
		organizationResults        []*generated.Organization
		organizationsettingResults []*generated.OrganizationSetting
		personalaccesstokenResults []*generated.PersonalAccessToken
		procedureResults           []*generated.Procedure
		programResults             []*generated.Program
		riskResults                []*generated.Risk
		standardResults            []*generated.Standard
		subcontrolResults          []*generated.Subcontrol
		subscriberResults          []*generated.Subscriber
		tfasettingResults          []*generated.TFASetting
		taskResults                []*generated.Task
		templateResults            []*generated.Template
		userResults                []*generated.User
		usersettingResults         []*generated.UserSetting
	)

	r.withPool().SubmitMultipleAndWait([]func(){
		func() {
			var err error
			apitokenResults, err = searchAPITokens(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			actionplanResults, err = searchActionPlans(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			contactResults, err = searchContacts(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			controlResults, err = searchControls(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			controlobjectiveResults, err = searchControlObjectives(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			documentdataResults, err = searchDocumentData(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			entityResults, err = searchEntities(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			entitytypeResults, err = searchEntityTypes(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			eventResults, err = searchEvents(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			fileResults, err = searchFiles(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			groupResults, err = searchGroups(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			groupsettingResults, err = searchGroupSettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			integrationResults, err = searchIntegrations(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			internalpolicyResults, err = searchInternalPolicies(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			narrativeResults, err = searchNarratives(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			orgsubscriptionResults, err = searchOrgSubscriptions(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			organizationResults, err = searchOrganizations(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			organizationsettingResults, err = searchOrganizationSettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			personalaccesstokenResults, err = searchPersonalAccessTokens(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			procedureResults, err = searchProcedures(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			programResults, err = searchPrograms(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			riskResults, err = searchRisks(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			standardResults, err = searchStandards(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			subcontrolResults, err = searchSubcontrols(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			subscriberResults, err = searchSubscribers(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			tfasettingResults, err = searchTFASettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			taskResults, err = searchTasks(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			templateResults, err = searchTemplates(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			userResults, err = searchUsers(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			usersettingResults, err = searchUserSettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
	})

	// Check all errors and return a single error if any of the searches failed
	if len(errors) > 0 {
		log.Error().Errs("errors", errors).Msg("search failed")

		return nil, ErrSearchFailed
	}

	// return the results
	var nodes []model.SearchResult
	resultCount := 0
	if len(apitokenResults) > 0 {
		nodes = append(nodes, model.APITokenSearchResult{
			APITokens: apitokenResults,
		})

		resultCount += len(apitokenResults)
	}
	if len(actionplanResults) > 0 {
		nodes = append(nodes, model.ActionPlanSearchResult{
			ActionPlans: actionplanResults,
		})

		resultCount += len(actionplanResults)
	}
	if len(contactResults) > 0 {
		nodes = append(nodes, model.ContactSearchResult{
			Contacts: contactResults,
		})

		resultCount += len(contactResults)
	}
	if len(controlResults) > 0 {
		nodes = append(nodes, model.ControlSearchResult{
			Controls: controlResults,
		})

		resultCount += len(controlResults)
	}
	if len(controlobjectiveResults) > 0 {
		nodes = append(nodes, model.ControlObjectiveSearchResult{
			ControlObjectives: controlobjectiveResults,
		})

		resultCount += len(controlobjectiveResults)
	}
	if len(documentdataResults) > 0 {
		nodes = append(nodes, model.DocumentDataSearchResult{
			DocumentData: documentdataResults,
		})

		resultCount += len(documentdataResults)
	}
	if len(entityResults) > 0 {
		nodes = append(nodes, model.EntitySearchResult{
			Entities: entityResults,
		})

		resultCount += len(entityResults)
	}
	if len(entitytypeResults) > 0 {
		nodes = append(nodes, model.EntityTypeSearchResult{
			EntityTypes: entitytypeResults,
		})

		resultCount += len(entitytypeResults)
	}
	if len(eventResults) > 0 {
		nodes = append(nodes, model.EventSearchResult{
			Events: eventResults,
		})

		resultCount += len(eventResults)
	}
	if len(fileResults) > 0 {
		nodes = append(nodes, model.FileSearchResult{
			Files: fileResults,
		})

		resultCount += len(fileResults)
	}
	if len(groupResults) > 0 {
		nodes = append(nodes, model.GroupSearchResult{
			Groups: groupResults,
		})

		resultCount += len(groupResults)
	}
	if len(groupsettingResults) > 0 {
		nodes = append(nodes, model.GroupSettingSearchResult{
			GroupSettings: groupsettingResults,
		})

		resultCount += len(groupsettingResults)
	}
	if len(integrationResults) > 0 {
		nodes = append(nodes, model.IntegrationSearchResult{
			Integrations: integrationResults,
		})

		resultCount += len(integrationResults)
	}
	if len(internalpolicyResults) > 0 {
		nodes = append(nodes, model.InternalPolicySearchResult{
			InternalPolicies: internalpolicyResults,
		})

		resultCount += len(internalpolicyResults)
	}
	if len(narrativeResults) > 0 {
		nodes = append(nodes, model.NarrativeSearchResult{
			Narratives: narrativeResults,
		})

		resultCount += len(narrativeResults)
	}
	if len(orgsubscriptionResults) > 0 {
		nodes = append(nodes, model.OrgSubscriptionSearchResult{
			OrgSubscriptions: orgsubscriptionResults,
		})

		resultCount += len(orgsubscriptionResults)
	}
	if len(organizationResults) > 0 {
		nodes = append(nodes, model.OrganizationSearchResult{
			Organizations: organizationResults,
		})

		resultCount += len(organizationResults)
	}
	if len(organizationsettingResults) > 0 {
		nodes = append(nodes, model.OrganizationSettingSearchResult{
			OrganizationSettings: organizationsettingResults,
		})

		resultCount += len(organizationsettingResults)
	}
	if len(personalaccesstokenResults) > 0 {
		nodes = append(nodes, model.PersonalAccessTokenSearchResult{
			PersonalAccessTokens: personalaccesstokenResults,
		})

		resultCount += len(personalaccesstokenResults)
	}
	if len(procedureResults) > 0 {
		nodes = append(nodes, model.ProcedureSearchResult{
			Procedures: procedureResults,
		})

		resultCount += len(procedureResults)
	}
	if len(programResults) > 0 {
		nodes = append(nodes, model.ProgramSearchResult{
			Programs: programResults,
		})

		resultCount += len(programResults)
	}
	if len(riskResults) > 0 {
		nodes = append(nodes, model.RiskSearchResult{
			Risks: riskResults,
		})

		resultCount += len(riskResults)
	}
	if len(standardResults) > 0 {
		nodes = append(nodes, model.StandardSearchResult{
			Standards: standardResults,
		})

		resultCount += len(standardResults)
	}
	if len(subcontrolResults) > 0 {
		nodes = append(nodes, model.SubcontrolSearchResult{
			Subcontrols: subcontrolResults,
		})

		resultCount += len(subcontrolResults)
	}
	if len(subscriberResults) > 0 {
		nodes = append(nodes, model.SubscriberSearchResult{
			Subscribers: subscriberResults,
		})

		resultCount += len(subscriberResults)
	}
	if len(tfasettingResults) > 0 {
		nodes = append(nodes, model.TFASettingSearchResult{
			TFASettings: tfasettingResults,
		})

		resultCount += len(tfasettingResults)
	}
	if len(taskResults) > 0 {
		nodes = append(nodes, model.TaskSearchResult{
			Tasks: taskResults,
		})

		resultCount += len(taskResults)
	}
	if len(templateResults) > 0 {
		nodes = append(nodes, model.TemplateSearchResult{
			Templates: templateResults,
		})

		resultCount += len(templateResults)
	}
	if len(userResults) > 0 {
		nodes = append(nodes, model.UserSearchResult{
			Users: userResults,
		})

		resultCount += len(userResults)
	}
	if len(usersettingResults) > 0 {
		nodes = append(nodes, model.UserSettingSearchResult{
			UserSettings: usersettingResults,
		})

		resultCount += len(usersettingResults)
	}

	return &model.SearchResultConnection{
		TotalCount: resultCount,
		Nodes:      nodes,
	}, nil
}

// Search is the resolver for the search field.
func (r *queryResolver) AdminSearch(ctx context.Context, query string) (*model.SearchResultConnection, error) {
	if len(query) < 3 {
		return nil, ErrSearchQueryTooShort
	}

	var (
		errors                     []error
		apitokenResults            []*generated.APIToken
		actionplanResults          []*generated.ActionPlan
		contactResults             []*generated.Contact
		controlResults             []*generated.Control
		controlobjectiveResults    []*generated.ControlObjective
		documentdataResults        []*generated.DocumentData
		entityResults              []*generated.Entity
		entitytypeResults          []*generated.EntityType
		eventResults               []*generated.Event
		fileResults                []*generated.File
		groupResults               []*generated.Group
		groupsettingResults        []*generated.GroupSetting
		integrationResults         []*generated.Integration
		internalpolicyResults      []*generated.InternalPolicy
		narrativeResults           []*generated.Narrative
		orgsubscriptionResults     []*generated.OrgSubscription
		organizationResults        []*generated.Organization
		organizationsettingResults []*generated.OrganizationSetting
		personalaccesstokenResults []*generated.PersonalAccessToken
		procedureResults           []*generated.Procedure
		programResults             []*generated.Program
		riskResults                []*generated.Risk
		standardResults            []*generated.Standard
		subcontrolResults          []*generated.Subcontrol
		subscriberResults          []*generated.Subscriber
		tfasettingResults          []*generated.TFASetting
		taskResults                []*generated.Task
		templateResults            []*generated.Template
		userResults                []*generated.User
		usersettingResults         []*generated.UserSetting
	)

	r.withPool().SubmitMultipleAndWait([]func(){
		func() {
			var err error
			apitokenResults, err = searchAPITokens(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			actionplanResults, err = searchActionPlans(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			contactResults, err = searchContacts(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			controlResults, err = searchControls(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			controlobjectiveResults, err = searchControlObjectives(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			documentdataResults, err = searchDocumentData(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			entityResults, err = searchEntities(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			entitytypeResults, err = searchEntityTypes(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			eventResults, err = searchEvents(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			fileResults, err = searchFiles(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			groupResults, err = searchGroups(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			groupsettingResults, err = searchGroupSettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			integrationResults, err = searchIntegrations(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			internalpolicyResults, err = searchInternalPolicies(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			narrativeResults, err = searchNarratives(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			orgsubscriptionResults, err = searchOrgSubscriptions(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			organizationResults, err = searchOrganizations(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			organizationsettingResults, err = searchOrganizationSettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			personalaccesstokenResults, err = searchPersonalAccessTokens(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			procedureResults, err = searchProcedures(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			programResults, err = searchPrograms(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			riskResults, err = searchRisks(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			standardResults, err = searchStandards(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			subcontrolResults, err = searchSubcontrols(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			subscriberResults, err = searchSubscribers(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			tfasettingResults, err = searchTFASettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			taskResults, err = searchTasks(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			templateResults, err = searchTemplates(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			userResults, err = searchUsers(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
		func() {
			var err error
			usersettingResults, err = searchUserSettings(ctx, query)
			if err != nil {
				errors = append(errors, err)
			}
		},
	})

	// Check all errors and return a single error if any of the searches failed
	if len(errors) > 0 {
		log.Error().Errs("errors", errors).Msg("search failed")

		return nil, ErrSearchFailed
	}

	// return the results
	var nodes []model.SearchResult
	resultCount := 0
	if len(apitokenResults) > 0 {
		nodes = append(nodes, model.APITokenSearchResult{
			APITokens: apitokenResults,
		})

		resultCount += len(apitokenResults)
	}
	if len(actionplanResults) > 0 {
		nodes = append(nodes, model.ActionPlanSearchResult{
			ActionPlans: actionplanResults,
		})

		resultCount += len(actionplanResults)
	}
	if len(contactResults) > 0 {
		nodes = append(nodes, model.ContactSearchResult{
			Contacts: contactResults,
		})

		resultCount += len(contactResults)
	}
	if len(controlResults) > 0 {
		nodes = append(nodes, model.ControlSearchResult{
			Controls: controlResults,
		})

		resultCount += len(controlResults)
	}
	if len(controlobjectiveResults) > 0 {
		nodes = append(nodes, model.ControlObjectiveSearchResult{
			ControlObjectives: controlobjectiveResults,
		})

		resultCount += len(controlobjectiveResults)
	}
	if len(documentdataResults) > 0 {
		nodes = append(nodes, model.DocumentDataSearchResult{
			DocumentData: documentdataResults,
		})

		resultCount += len(documentdataResults)
	}
	if len(entityResults) > 0 {
		nodes = append(nodes, model.EntitySearchResult{
			Entities: entityResults,
		})

		resultCount += len(entityResults)
	}
	if len(entitytypeResults) > 0 {
		nodes = append(nodes, model.EntityTypeSearchResult{
			EntityTypes: entitytypeResults,
		})

		resultCount += len(entitytypeResults)
	}
	if len(eventResults) > 0 {
		nodes = append(nodes, model.EventSearchResult{
			Events: eventResults,
		})

		resultCount += len(eventResults)
	}
	if len(fileResults) > 0 {
		nodes = append(nodes, model.FileSearchResult{
			Files: fileResults,
		})

		resultCount += len(fileResults)
	}
	if len(groupResults) > 0 {
		nodes = append(nodes, model.GroupSearchResult{
			Groups: groupResults,
		})

		resultCount += len(groupResults)
	}
	if len(groupsettingResults) > 0 {
		nodes = append(nodes, model.GroupSettingSearchResult{
			GroupSettings: groupsettingResults,
		})

		resultCount += len(groupsettingResults)
	}
	if len(integrationResults) > 0 {
		nodes = append(nodes, model.IntegrationSearchResult{
			Integrations: integrationResults,
		})

		resultCount += len(integrationResults)
	}
	if len(internalpolicyResults) > 0 {
		nodes = append(nodes, model.InternalPolicySearchResult{
			InternalPolicies: internalpolicyResults,
		})

		resultCount += len(internalpolicyResults)
	}
	if len(narrativeResults) > 0 {
		nodes = append(nodes, model.NarrativeSearchResult{
			Narratives: narrativeResults,
		})

		resultCount += len(narrativeResults)
	}
	if len(orgsubscriptionResults) > 0 {
		nodes = append(nodes, model.OrgSubscriptionSearchResult{
			OrgSubscriptions: orgsubscriptionResults,
		})

		resultCount += len(orgsubscriptionResults)
	}
	if len(organizationResults) > 0 {
		nodes = append(nodes, model.OrganizationSearchResult{
			Organizations: organizationResults,
		})

		resultCount += len(organizationResults)
	}
	if len(organizationsettingResults) > 0 {
		nodes = append(nodes, model.OrganizationSettingSearchResult{
			OrganizationSettings: organizationsettingResults,
		})

		resultCount += len(organizationsettingResults)
	}
	if len(personalaccesstokenResults) > 0 {
		nodes = append(nodes, model.PersonalAccessTokenSearchResult{
			PersonalAccessTokens: personalaccesstokenResults,
		})

		resultCount += len(personalaccesstokenResults)
	}
	if len(procedureResults) > 0 {
		nodes = append(nodes, model.ProcedureSearchResult{
			Procedures: procedureResults,
		})

		resultCount += len(procedureResults)
	}
	if len(programResults) > 0 {
		nodes = append(nodes, model.ProgramSearchResult{
			Programs: programResults,
		})

		resultCount += len(programResults)
	}
	if len(riskResults) > 0 {
		nodes = append(nodes, model.RiskSearchResult{
			Risks: riskResults,
		})

		resultCount += len(riskResults)
	}
	if len(standardResults) > 0 {
		nodes = append(nodes, model.StandardSearchResult{
			Standards: standardResults,
		})

		resultCount += len(standardResults)
	}
	if len(subcontrolResults) > 0 {
		nodes = append(nodes, model.SubcontrolSearchResult{
			Subcontrols: subcontrolResults,
		})

		resultCount += len(subcontrolResults)
	}
	if len(subscriberResults) > 0 {
		nodes = append(nodes, model.SubscriberSearchResult{
			Subscribers: subscriberResults,
		})

		resultCount += len(subscriberResults)
	}
	if len(tfasettingResults) > 0 {
		nodes = append(nodes, model.TFASettingSearchResult{
			TFASettings: tfasettingResults,
		})

		resultCount += len(tfasettingResults)
	}
	if len(taskResults) > 0 {
		nodes = append(nodes, model.TaskSearchResult{
			Tasks: taskResults,
		})

		resultCount += len(taskResults)
	}
	if len(templateResults) > 0 {
		nodes = append(nodes, model.TemplateSearchResult{
			Templates: templateResults,
		})

		resultCount += len(templateResults)
	}
	if len(userResults) > 0 {
		nodes = append(nodes, model.UserSearchResult{
			Users: userResults,
		})

		resultCount += len(userResults)
	}
	if len(usersettingResults) > 0 {
		nodes = append(nodes, model.UserSettingSearchResult{
			UserSettings: usersettingResults,
		})

		resultCount += len(usersettingResults)
	}

	return &model.SearchResultConnection{
		TotalCount: resultCount,
		Nodes:      nodes,
	}, nil
}
