// Code generated by ent, DO NOT EDIT.

package generated

import (
	"fmt"

	"github.com/theopenlane/core/common/enums"
)

// WorkflowError wraps workflow execution errors with structured context
type WorkflowError struct {
	InstanceID    string
	DefinitionID  string
	ObjectID      string
	ObjectType    enums.WorkflowObjectType
	ActionKey     string
	ActionIndex   int
	ActionType    enums.WorkflowActionType
	OriginalError error
}

// Error implements the error interface
func (e *WorkflowError) Error() string {
	if e.ActionKey != "" {
		return fmt.Sprintf("workflow error: instance=%s definition=%s object=%s/%s action=%s(%d,%s): %v",
			e.InstanceID, e.DefinitionID, e.ObjectType, e.ObjectID,
			e.ActionKey, e.ActionIndex, e.ActionType, e.OriginalError)
	}
	return fmt.Sprintf("workflow error: instance=%s definition=%s object=%s/%s: %v",
		e.InstanceID, e.DefinitionID, e.ObjectType, e.ObjectID, e.OriginalError)
}

// Unwrap returns the underlying error
func (e *WorkflowError) Unwrap() error {
	return e.OriginalError
}

// NewWorkflowError creates a WorkflowError from a WorkflowInstance entity
func NewWorkflowError(instance *WorkflowInstance, objectType enums.WorkflowObjectType, objectID string, err error) *WorkflowError {
	if instance == nil {
		return &WorkflowError{
			ObjectType:    objectType,
			ObjectID:      objectID,
			OriginalError: err,
		}
	}
	return &WorkflowError{
		InstanceID:    instance.ID,
		DefinitionID:  instance.WorkflowDefinitionID,
		ObjectType:    objectType,
		ObjectID:      objectID,
		OriginalError: err,
	}
}

// WrapWorkflowError wraps an error with workflow context
func WrapWorkflowError(instanceID, definitionID, objectID string, objectType enums.WorkflowObjectType, err error) *WorkflowError {
	return &WorkflowError{
		InstanceID:    instanceID,
		DefinitionID:  definitionID,
		ObjectID:      objectID,
		ObjectType:    objectType,
		OriginalError: err,
	}
}

// WithAction adds action context to a WorkflowError
func (e *WorkflowError) WithAction(actionKey string, actionIndex int, actionType enums.WorkflowActionType) *WorkflowError {
	e.ActionKey = actionKey
	e.ActionIndex = actionIndex
	e.ActionType = actionType
	return e
}
