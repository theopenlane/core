// Code generated by ent, DO NOT EDIT.

package generated

import (
	"context"
	"fmt"

	"github.com/theopenlane/core/common/enums"
)

// CreateWorkflowInstanceForObject creates a workflow instance and object ref for a given object type
func (c *Client) CreateWorkflowInstanceForObject(ctx context.Context, definitionID string, objectType enums.WorkflowObjectType, objectID string, orgID string) (*WorkflowInstance, error) {
	// Create the workflow instance
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	// Create the workflow object ref based on object type
	refCreate := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetOwnerID(orgID)

	switch objectType {
	case enums.WorkflowObjectTypeActionPlan:
		refCreate.SetActionPlanID(objectID)
	case enums.WorkflowObjectTypeControl:
		refCreate.SetControlID(objectID)
	case enums.WorkflowObjectTypeEvidence:
		refCreate.SetEvidenceID(objectID)
	case enums.WorkflowObjectTypeInternalPolicy:
		refCreate.SetInternalPolicyID(objectID)
	case enums.WorkflowObjectTypeProcedure:
		refCreate.SetProcedureID(objectID)
	case enums.WorkflowObjectTypeSubcontrol:
		refCreate.SetSubcontrolID(objectID)
	default:
		return nil, fmt.Errorf("unsupported object type: %s", objectType)
	}

	if _, err := refCreate.Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}

// CreateWorkflowInstanceForActionPlan creates a workflow instance and object ref for a ActionPlan
func (c *Client) CreateWorkflowInstanceForActionPlan(ctx context.Context, definitionID string, actionplanID string, orgID string) (*WorkflowInstance, error) {
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	if _, err := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetActionPlanID(actionplanID).
		SetOwnerID(orgID).
		Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}

// CreateWorkflowInstanceForControl creates a workflow instance and object ref for a Control
func (c *Client) CreateWorkflowInstanceForControl(ctx context.Context, definitionID string, controlID string, orgID string) (*WorkflowInstance, error) {
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	if _, err := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetControlID(controlID).
		SetOwnerID(orgID).
		Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}

// CreateWorkflowInstanceForEvidence creates a workflow instance and object ref for a Evidence
func (c *Client) CreateWorkflowInstanceForEvidence(ctx context.Context, definitionID string, evidenceID string, orgID string) (*WorkflowInstance, error) {
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	if _, err := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetEvidenceID(evidenceID).
		SetOwnerID(orgID).
		Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}

// CreateWorkflowInstanceForInternalPolicy creates a workflow instance and object ref for a InternalPolicy
func (c *Client) CreateWorkflowInstanceForInternalPolicy(ctx context.Context, definitionID string, internalpolicyID string, orgID string) (*WorkflowInstance, error) {
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	if _, err := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetInternalPolicyID(internalpolicyID).
		SetOwnerID(orgID).
		Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}

// CreateWorkflowInstanceForProcedure creates a workflow instance and object ref for a Procedure
func (c *Client) CreateWorkflowInstanceForProcedure(ctx context.Context, definitionID string, procedureID string, orgID string) (*WorkflowInstance, error) {
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	if _, err := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetProcedureID(procedureID).
		SetOwnerID(orgID).
		Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}

// CreateWorkflowInstanceForSubcontrol creates a workflow instance and object ref for a Subcontrol
func (c *Client) CreateWorkflowInstanceForSubcontrol(ctx context.Context, definitionID string, subcontrolID string, orgID string) (*WorkflowInstance, error) {
	instance, err := c.WorkflowInstance.Create().
		SetWorkflowDefinitionID(definitionID).
		SetOwnerID(orgID).
		SetState(enums.WorkflowInstanceStateRunning).
		Save(ctx)
	if err != nil {
		return nil, err
	}

	if _, err := c.WorkflowObjectRef.Create().
		SetWorkflowInstanceID(instance.ID).
		SetSubcontrolID(subcontrolID).
		SetOwnerID(orgID).
		Save(ctx); err != nil {
		return nil, err
	}

	return instance, nil
}
