{{- define "import/additional/logx" }}
	"github.com/theopenlane/core/pkg/logx"
{{- end }}

{{ define "query/additional/count" }}
	{{ $receiver := receiver $.QueryName }}

	// CountIDs returns the count of ids with FGA batch filtering applied
	func ({{ $receiver }} *{{ $.QueryName }}) CountIDs(ctx context.Context) (int, error) {
		logx.FromContext(ctx).Debug().Str("query_type", "{{ $.Name }}").Str("operation", "count_ids").Msg("CountIDs: starting")

		ctx = setContextOp(ctx, {{ $receiver }}.ctx, ent.OpQueryIDs)

		ids, err := {{ $receiver }}.IDs(ctx)
		if err != nil {
			logx.FromContext(ctx).Error().Err(err).Str("query_type", "{{ $.Name }}").Str("operation", "count_ids").Msg("CountIDs: IDs() failed")

			return 0, err
		}

		logx.FromContext(ctx).Debug().Str("query_type", "{{ $.Name }}").Str("operation", "count_ids").Int("count", len(ids)).Msg("CountIDs: completed")

		return len(ids), nil
	}
{{ end }}
