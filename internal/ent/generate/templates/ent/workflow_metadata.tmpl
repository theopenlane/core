{{/* Generate workflow metadata registry */}}
{{/* gotype: entgo.io/ent/entc/gen.Graph */}}

{{ define "workflow_metadata" }}

{{ $pkg := base $.Config.Package }}
package generated

import (
	"github.com/theopenlane/core/common/enums"
)

// Code generated by ent. DO NOT EDIT.
// This file is generated to provide workflow metadata from ent schemas.

// WorkflowFieldInfo represents metadata about a workflow-eligible field
type WorkflowFieldInfo struct {
	Name  string
	Label string
	Type  string
}

// WorkflowObjectTypeInfo represents metadata about a workflow-eligible object type
type WorkflowObjectTypeInfo struct {
	Type           enums.WorkflowObjectType
	Label          string
	Description    string
	EligibleFields []WorkflowFieldInfo
}

// GetWorkflowMetadata returns all workflow-eligible object types and their fields
func GetWorkflowMetadata() []WorkflowObjectTypeInfo {
	return []WorkflowObjectTypeInfo{
		{{- range $n := $.Nodes }}
			{{- $hasWorkflowFields := false }}
			{{- $isHistory := false }}
			{{- if hasSuffix $n.Name "History" }}{{ $isHistory = true }}{{ end }}
			{{- range $f := $n.Fields }}
				{{- if $f.Annotations.OPENLANE_WORKFLOW_ELIGIBLE }}{{ $hasWorkflowFields = true }}{{ end }}
			{{- end }}
			{{- if and $hasWorkflowFields (not $isHistory) }}
		{
			Type:        enums.WorkflowObjectType{{ $n.Name }},
			Label:       "{{ $n.Name }}",
			Description: "{{ $n.Name }} objects",
			EligibleFields: []WorkflowFieldInfo{
				{{- range $f := $n.Fields }}
					{{- if $f.Annotations.OPENLANE_WORKFLOW_ELIGIBLE }}
				{
					Name:  "{{ $f.Name }}",
					Label: "{{ pascal $f.Name }}",
					Type:  "{{ $f.Type.String }}",
				},
					{{- end }}
				{{- end }}
			},
		},
			{{- end }}
		{{- end }}
	}
}

{{ end }}
