//go:build !enthistorycodegen

// Code generated by ent, DO NOT EDIT.

package historygenerated

import (
	"context"
	"sync"

	"entgo.io/ent/dialect"
)

// Tx is a transactional client that is created by calling Client.Tx().
type Tx struct {
	config
	// ActionPlanHistory is the client for interacting with the ActionPlanHistory builders.
	ActionPlanHistory *ActionPlanHistoryClient
	// AssessmentHistory is the client for interacting with the AssessmentHistory builders.
	AssessmentHistory *AssessmentHistoryClient
	// AssessmentResponseHistory is the client for interacting with the AssessmentResponseHistory builders.
	AssessmentResponseHistory *AssessmentResponseHistoryClient
	// AssetHistory is the client for interacting with the AssetHistory builders.
	AssetHistory *AssetHistoryClient
	// CampaignHistory is the client for interacting with the CampaignHistory builders.
	CampaignHistory *CampaignHistoryClient
	// CampaignTargetHistory is the client for interacting with the CampaignTargetHistory builders.
	CampaignTargetHistory *CampaignTargetHistoryClient
	// ContactHistory is the client for interacting with the ContactHistory builders.
	ContactHistory *ContactHistoryClient
	// ControlHistory is the client for interacting with the ControlHistory builders.
	ControlHistory *ControlHistoryClient
	// ControlImplementationHistory is the client for interacting with the ControlImplementationHistory builders.
	ControlImplementationHistory *ControlImplementationHistoryClient
	// ControlObjectiveHistory is the client for interacting with the ControlObjectiveHistory builders.
	ControlObjectiveHistory *ControlObjectiveHistoryClient
	// CustomDomainHistory is the client for interacting with the CustomDomainHistory builders.
	CustomDomainHistory *CustomDomainHistoryClient
	// DNSVerificationHistory is the client for interacting with the DNSVerificationHistory builders.
	DNSVerificationHistory *DNSVerificationHistoryClient
	// DirectoryAccountHistory is the client for interacting with the DirectoryAccountHistory builders.
	DirectoryAccountHistory *DirectoryAccountHistoryClient
	// DirectoryGroupHistory is the client for interacting with the DirectoryGroupHistory builders.
	DirectoryGroupHistory *DirectoryGroupHistoryClient
	// DirectoryMembershipHistory is the client for interacting with the DirectoryMembershipHistory builders.
	DirectoryMembershipHistory *DirectoryMembershipHistoryClient
	// DiscussionHistory is the client for interacting with the DiscussionHistory builders.
	DiscussionHistory *DiscussionHistoryClient
	// DocumentDataHistory is the client for interacting with the DocumentDataHistory builders.
	DocumentDataHistory *DocumentDataHistoryClient
	// EmailBrandingHistory is the client for interacting with the EmailBrandingHistory builders.
	EmailBrandingHistory *EmailBrandingHistoryClient
	// EmailTemplateHistory is the client for interacting with the EmailTemplateHistory builders.
	EmailTemplateHistory *EmailTemplateHistoryClient
	// EntityHistory is the client for interacting with the EntityHistory builders.
	EntityHistory *EntityHistoryClient
	// EntityTypeHistory is the client for interacting with the EntityTypeHistory builders.
	EntityTypeHistory *EntityTypeHistoryClient
	// EvidenceHistory is the client for interacting with the EvidenceHistory builders.
	EvidenceHistory *EvidenceHistoryClient
	// FileHistory is the client for interacting with the FileHistory builders.
	FileHistory *FileHistoryClient
	// FindingControlHistory is the client for interacting with the FindingControlHistory builders.
	FindingControlHistory *FindingControlHistoryClient
	// FindingHistory is the client for interacting with the FindingHistory builders.
	FindingHistory *FindingHistoryClient
	// GroupHistory is the client for interacting with the GroupHistory builders.
	GroupHistory *GroupHistoryClient
	// GroupMembershipHistory is the client for interacting with the GroupMembershipHistory builders.
	GroupMembershipHistory *GroupMembershipHistoryClient
	// GroupSettingHistory is the client for interacting with the GroupSettingHistory builders.
	GroupSettingHistory *GroupSettingHistoryClient
	// HushHistory is the client for interacting with the HushHistory builders.
	HushHistory *HushHistoryClient
	// IdentityHolderHistory is the client for interacting with the IdentityHolderHistory builders.
	IdentityHolderHistory *IdentityHolderHistoryClient
	// IntegrationHistory is the client for interacting with the IntegrationHistory builders.
	IntegrationHistory *IntegrationHistoryClient
	// InternalPolicyHistory is the client for interacting with the InternalPolicyHistory builders.
	InternalPolicyHistory *InternalPolicyHistoryClient
	// JobTemplateHistory is the client for interacting with the JobTemplateHistory builders.
	JobTemplateHistory *JobTemplateHistoryClient
	// MappableDomainHistory is the client for interacting with the MappableDomainHistory builders.
	MappableDomainHistory *MappableDomainHistoryClient
	// MappedControlHistory is the client for interacting with the MappedControlHistory builders.
	MappedControlHistory *MappedControlHistoryClient
	// NarrativeHistory is the client for interacting with the NarrativeHistory builders.
	NarrativeHistory *NarrativeHistoryClient
	// NoteHistory is the client for interacting with the NoteHistory builders.
	NoteHistory *NoteHistoryClient
	// NotificationPreferenceHistory is the client for interacting with the NotificationPreferenceHistory builders.
	NotificationPreferenceHistory *NotificationPreferenceHistoryClient
	// NotificationTemplateHistory is the client for interacting with the NotificationTemplateHistory builders.
	NotificationTemplateHistory *NotificationTemplateHistoryClient
	// OrgMembershipHistory is the client for interacting with the OrgMembershipHistory builders.
	OrgMembershipHistory *OrgMembershipHistoryClient
	// OrgSubscriptionHistory is the client for interacting with the OrgSubscriptionHistory builders.
	OrgSubscriptionHistory *OrgSubscriptionHistoryClient
	// OrganizationHistory is the client for interacting with the OrganizationHistory builders.
	OrganizationHistory *OrganizationHistoryClient
	// OrganizationSettingHistory is the client for interacting with the OrganizationSettingHistory builders.
	OrganizationSettingHistory *OrganizationSettingHistoryClient
	// PlatformHistory is the client for interacting with the PlatformHistory builders.
	PlatformHistory *PlatformHistoryClient
	// ProcedureHistory is the client for interacting with the ProcedureHistory builders.
	ProcedureHistory *ProcedureHistoryClient
	// ProgramHistory is the client for interacting with the ProgramHistory builders.
	ProgramHistory *ProgramHistoryClient
	// ProgramMembershipHistory is the client for interacting with the ProgramMembershipHistory builders.
	ProgramMembershipHistory *ProgramMembershipHistoryClient
	// RemediationHistory is the client for interacting with the RemediationHistory builders.
	RemediationHistory *RemediationHistoryClient
	// ReviewHistory is the client for interacting with the ReviewHistory builders.
	ReviewHistory *ReviewHistoryClient
	// RiskHistory is the client for interacting with the RiskHistory builders.
	RiskHistory *RiskHistoryClient
	// ScanHistory is the client for interacting with the ScanHistory builders.
	ScanHistory *ScanHistoryClient
	// ScheduledJobHistory is the client for interacting with the ScheduledJobHistory builders.
	ScheduledJobHistory *ScheduledJobHistoryClient
	// StandardHistory is the client for interacting with the StandardHistory builders.
	StandardHistory *StandardHistoryClient
	// SubcontrolHistory is the client for interacting with the SubcontrolHistory builders.
	SubcontrolHistory *SubcontrolHistoryClient
	// SubprocessorHistory is the client for interacting with the SubprocessorHistory builders.
	SubprocessorHistory *SubprocessorHistoryClient
	// TaskHistory is the client for interacting with the TaskHistory builders.
	TaskHistory *TaskHistoryClient
	// TemplateHistory is the client for interacting with the TemplateHistory builders.
	TemplateHistory *TemplateHistoryClient
	// TrustCenterComplianceHistory is the client for interacting with the TrustCenterComplianceHistory builders.
	TrustCenterComplianceHistory *TrustCenterComplianceHistoryClient
	// TrustCenterDocHistory is the client for interacting with the TrustCenterDocHistory builders.
	TrustCenterDocHistory *TrustCenterDocHistoryClient
	// TrustCenterEntityHistory is the client for interacting with the TrustCenterEntityHistory builders.
	TrustCenterEntityHistory *TrustCenterEntityHistoryClient
	// TrustCenterHistory is the client for interacting with the TrustCenterHistory builders.
	TrustCenterHistory *TrustCenterHistoryClient
	// TrustCenterNDARequestHistory is the client for interacting with the TrustCenterNDARequestHistory builders.
	TrustCenterNDARequestHistory *TrustCenterNDARequestHistoryClient
	// TrustCenterSettingHistory is the client for interacting with the TrustCenterSettingHistory builders.
	TrustCenterSettingHistory *TrustCenterSettingHistoryClient
	// TrustCenterSubprocessorHistory is the client for interacting with the TrustCenterSubprocessorHistory builders.
	TrustCenterSubprocessorHistory *TrustCenterSubprocessorHistoryClient
	// TrustCenterWatermarkConfigHistory is the client for interacting with the TrustCenterWatermarkConfigHistory builders.
	TrustCenterWatermarkConfigHistory *TrustCenterWatermarkConfigHistoryClient
	// UserHistory is the client for interacting with the UserHistory builders.
	UserHistory *UserHistoryClient
	// UserSettingHistory is the client for interacting with the UserSettingHistory builders.
	UserSettingHistory *UserSettingHistoryClient
	// VulnerabilityHistory is the client for interacting with the VulnerabilityHistory builders.
	VulnerabilityHistory *VulnerabilityHistoryClient
	// WorkflowAssignmentHistory is the client for interacting with the WorkflowAssignmentHistory builders.
	WorkflowAssignmentHistory *WorkflowAssignmentHistoryClient
	// WorkflowAssignmentTargetHistory is the client for interacting with the WorkflowAssignmentTargetHistory builders.
	WorkflowAssignmentTargetHistory *WorkflowAssignmentTargetHistoryClient
	// WorkflowDefinitionHistory is the client for interacting with the WorkflowDefinitionHistory builders.
	WorkflowDefinitionHistory *WorkflowDefinitionHistoryClient
	// WorkflowEventHistory is the client for interacting with the WorkflowEventHistory builders.
	WorkflowEventHistory *WorkflowEventHistoryClient
	// WorkflowInstanceHistory is the client for interacting with the WorkflowInstanceHistory builders.
	WorkflowInstanceHistory *WorkflowInstanceHistoryClient
	// WorkflowObjectRefHistory is the client for interacting with the WorkflowObjectRefHistory builders.
	WorkflowObjectRefHistory *WorkflowObjectRefHistoryClient

	// lazily loaded.
	client     *Client
	clientOnce sync.Once
	// ctx lives for the life of the transaction. It is
	// the same context used by the underlying connection.
	ctx context.Context
}

type (
	// Committer is the interface that wraps the Commit method.
	Committer interface {
		Commit(context.Context, *Tx) error
	}

	// The CommitFunc type is an adapter to allow the use of ordinary
	// function as a Committer. If f is a function with the appropriate
	// signature, CommitFunc(f) is a Committer that calls f.
	CommitFunc func(context.Context, *Tx) error

	// CommitHook defines the "commit middleware". A function that gets a Committer
	// and returns a Committer. For example:
	//
	//	hook := func(next ent.Committer) ent.Committer {
	//		return ent.CommitFunc(func(ctx context.Context, tx *ent.Tx) error {
	//			// Do some stuff before.
	//			if err := next.Commit(ctx, tx); err != nil {
	//				return err
	//			}
	//			// Do some stuff after.
	//			return nil
	//		})
	//	}
	//
	CommitHook func(Committer) Committer
)

// Commit calls f(ctx, m).
func (f CommitFunc) Commit(ctx context.Context, tx *Tx) error {
	return f(ctx, tx)
}

// Commit commits the transaction.
func (tx *Tx) Commit() error {
	txDriver := tx.config.driver.(*txDriver)
	var fn Committer = CommitFunc(func(context.Context, *Tx) error {
		return txDriver.tx.Commit()
	})
	txDriver.mu.Lock()
	hooks := append([]CommitHook(nil), txDriver.onCommit...)
	txDriver.mu.Unlock()
	for i := len(hooks) - 1; i >= 0; i-- {
		fn = hooks[i](fn)
	}
	return fn.Commit(tx.ctx, tx)
}

// OnCommit adds a hook to call on commit.
func (tx *Tx) OnCommit(f CommitHook) {
	txDriver := tx.config.driver.(*txDriver)
	txDriver.mu.Lock()
	txDriver.onCommit = append(txDriver.onCommit, f)
	txDriver.mu.Unlock()
}

type (
	// Rollbacker is the interface that wraps the Rollback method.
	Rollbacker interface {
		Rollback(context.Context, *Tx) error
	}

	// The RollbackFunc type is an adapter to allow the use of ordinary
	// function as a Rollbacker. If f is a function with the appropriate
	// signature, RollbackFunc(f) is a Rollbacker that calls f.
	RollbackFunc func(context.Context, *Tx) error

	// RollbackHook defines the "rollback middleware". A function that gets a Rollbacker
	// and returns a Rollbacker. For example:
	//
	//	hook := func(next ent.Rollbacker) ent.Rollbacker {
	//		return ent.RollbackFunc(func(ctx context.Context, tx *ent.Tx) error {
	//			// Do some stuff before.
	//			if err := next.Rollback(ctx, tx); err != nil {
	//				return err
	//			}
	//			// Do some stuff after.
	//			return nil
	//		})
	//	}
	//
	RollbackHook func(Rollbacker) Rollbacker
)

// Rollback calls f(ctx, m).
func (f RollbackFunc) Rollback(ctx context.Context, tx *Tx) error {
	return f(ctx, tx)
}

// Rollback rollbacks the transaction.
func (tx *Tx) Rollback() error {
	txDriver := tx.config.driver.(*txDriver)
	var fn Rollbacker = RollbackFunc(func(context.Context, *Tx) error {
		return txDriver.tx.Rollback()
	})
	txDriver.mu.Lock()
	hooks := append([]RollbackHook(nil), txDriver.onRollback...)
	txDriver.mu.Unlock()
	for i := len(hooks) - 1; i >= 0; i-- {
		fn = hooks[i](fn)
	}
	return fn.Rollback(tx.ctx, tx)
}

// OnRollback adds a hook to call on rollback.
func (tx *Tx) OnRollback(f RollbackHook) {
	txDriver := tx.config.driver.(*txDriver)
	txDriver.mu.Lock()
	txDriver.onRollback = append(txDriver.onRollback, f)
	txDriver.mu.Unlock()
}

// Client returns a Client that binds to current transaction.
func (tx *Tx) Client() *Client {
	tx.clientOnce.Do(func() {
		tx.client = &Client{config: tx.config}
		tx.client.init()
	})
	return tx.client
}

func (tx *Tx) init() {
	tx.ActionPlanHistory = NewActionPlanHistoryClient(tx.config)
	tx.AssessmentHistory = NewAssessmentHistoryClient(tx.config)
	tx.AssessmentResponseHistory = NewAssessmentResponseHistoryClient(tx.config)
	tx.AssetHistory = NewAssetHistoryClient(tx.config)
	tx.CampaignHistory = NewCampaignHistoryClient(tx.config)
	tx.CampaignTargetHistory = NewCampaignTargetHistoryClient(tx.config)
	tx.ContactHistory = NewContactHistoryClient(tx.config)
	tx.ControlHistory = NewControlHistoryClient(tx.config)
	tx.ControlImplementationHistory = NewControlImplementationHistoryClient(tx.config)
	tx.ControlObjectiveHistory = NewControlObjectiveHistoryClient(tx.config)
	tx.CustomDomainHistory = NewCustomDomainHistoryClient(tx.config)
	tx.DNSVerificationHistory = NewDNSVerificationHistoryClient(tx.config)
	tx.DirectoryAccountHistory = NewDirectoryAccountHistoryClient(tx.config)
	tx.DirectoryGroupHistory = NewDirectoryGroupHistoryClient(tx.config)
	tx.DirectoryMembershipHistory = NewDirectoryMembershipHistoryClient(tx.config)
	tx.DiscussionHistory = NewDiscussionHistoryClient(tx.config)
	tx.DocumentDataHistory = NewDocumentDataHistoryClient(tx.config)
	tx.EmailBrandingHistory = NewEmailBrandingHistoryClient(tx.config)
	tx.EmailTemplateHistory = NewEmailTemplateHistoryClient(tx.config)
	tx.EntityHistory = NewEntityHistoryClient(tx.config)
	tx.EntityTypeHistory = NewEntityTypeHistoryClient(tx.config)
	tx.EvidenceHistory = NewEvidenceHistoryClient(tx.config)
	tx.FileHistory = NewFileHistoryClient(tx.config)
	tx.FindingControlHistory = NewFindingControlHistoryClient(tx.config)
	tx.FindingHistory = NewFindingHistoryClient(tx.config)
	tx.GroupHistory = NewGroupHistoryClient(tx.config)
	tx.GroupMembershipHistory = NewGroupMembershipHistoryClient(tx.config)
	tx.GroupSettingHistory = NewGroupSettingHistoryClient(tx.config)
	tx.HushHistory = NewHushHistoryClient(tx.config)
	tx.IdentityHolderHistory = NewIdentityHolderHistoryClient(tx.config)
	tx.IntegrationHistory = NewIntegrationHistoryClient(tx.config)
	tx.InternalPolicyHistory = NewInternalPolicyHistoryClient(tx.config)
	tx.JobTemplateHistory = NewJobTemplateHistoryClient(tx.config)
	tx.MappableDomainHistory = NewMappableDomainHistoryClient(tx.config)
	tx.MappedControlHistory = NewMappedControlHistoryClient(tx.config)
	tx.NarrativeHistory = NewNarrativeHistoryClient(tx.config)
	tx.NoteHistory = NewNoteHistoryClient(tx.config)
	tx.NotificationPreferenceHistory = NewNotificationPreferenceHistoryClient(tx.config)
	tx.NotificationTemplateHistory = NewNotificationTemplateHistoryClient(tx.config)
	tx.OrgMembershipHistory = NewOrgMembershipHistoryClient(tx.config)
	tx.OrgSubscriptionHistory = NewOrgSubscriptionHistoryClient(tx.config)
	tx.OrganizationHistory = NewOrganizationHistoryClient(tx.config)
	tx.OrganizationSettingHistory = NewOrganizationSettingHistoryClient(tx.config)
	tx.PlatformHistory = NewPlatformHistoryClient(tx.config)
	tx.ProcedureHistory = NewProcedureHistoryClient(tx.config)
	tx.ProgramHistory = NewProgramHistoryClient(tx.config)
	tx.ProgramMembershipHistory = NewProgramMembershipHistoryClient(tx.config)
	tx.RemediationHistory = NewRemediationHistoryClient(tx.config)
	tx.ReviewHistory = NewReviewHistoryClient(tx.config)
	tx.RiskHistory = NewRiskHistoryClient(tx.config)
	tx.ScanHistory = NewScanHistoryClient(tx.config)
	tx.ScheduledJobHistory = NewScheduledJobHistoryClient(tx.config)
	tx.StandardHistory = NewStandardHistoryClient(tx.config)
	tx.SubcontrolHistory = NewSubcontrolHistoryClient(tx.config)
	tx.SubprocessorHistory = NewSubprocessorHistoryClient(tx.config)
	tx.TaskHistory = NewTaskHistoryClient(tx.config)
	tx.TemplateHistory = NewTemplateHistoryClient(tx.config)
	tx.TrustCenterComplianceHistory = NewTrustCenterComplianceHistoryClient(tx.config)
	tx.TrustCenterDocHistory = NewTrustCenterDocHistoryClient(tx.config)
	tx.TrustCenterEntityHistory = NewTrustCenterEntityHistoryClient(tx.config)
	tx.TrustCenterHistory = NewTrustCenterHistoryClient(tx.config)
	tx.TrustCenterNDARequestHistory = NewTrustCenterNDARequestHistoryClient(tx.config)
	tx.TrustCenterSettingHistory = NewTrustCenterSettingHistoryClient(tx.config)
	tx.TrustCenterSubprocessorHistory = NewTrustCenterSubprocessorHistoryClient(tx.config)
	tx.TrustCenterWatermarkConfigHistory = NewTrustCenterWatermarkConfigHistoryClient(tx.config)
	tx.UserHistory = NewUserHistoryClient(tx.config)
	tx.UserSettingHistory = NewUserSettingHistoryClient(tx.config)
	tx.VulnerabilityHistory = NewVulnerabilityHistoryClient(tx.config)
	tx.WorkflowAssignmentHistory = NewWorkflowAssignmentHistoryClient(tx.config)
	tx.WorkflowAssignmentTargetHistory = NewWorkflowAssignmentTargetHistoryClient(tx.config)
	tx.WorkflowDefinitionHistory = NewWorkflowDefinitionHistoryClient(tx.config)
	tx.WorkflowEventHistory = NewWorkflowEventHistoryClient(tx.config)
	tx.WorkflowInstanceHistory = NewWorkflowInstanceHistoryClient(tx.config)
	tx.WorkflowObjectRefHistory = NewWorkflowObjectRefHistoryClient(tx.config)
}

// txDriver wraps the given dialect.Tx with a nop dialect.Driver implementation.
// The idea is to support transactions without adding any extra code to the builders.
// When a builder calls to driver.Tx(), it gets the same dialect.Tx instance.
// Commit and Rollback are nop for the internal builders and the user must call one
// of them in order to commit or rollback the transaction.
//
// If a closed transaction is embedded in one of the generated entities, and the entity
// applies a query, for example: ActionPlanHistory.QueryXXX(), the query will be executed
// through the driver which created this transaction.
//
// Note that txDriver is not goroutine safe.
type txDriver struct {
	// the driver we started the transaction from.
	drv dialect.Driver
	// tx is the underlying transaction.
	tx dialect.Tx
	// completion hooks.
	mu         sync.Mutex
	onCommit   []CommitHook
	onRollback []RollbackHook
}

// newTx creates a new transactional driver.
func newTx(ctx context.Context, drv dialect.Driver) (*txDriver, error) {
	tx, err := drv.Tx(ctx)
	if err != nil {
		return nil, err
	}
	return &txDriver{tx: tx, drv: drv}, nil
}

// Tx returns the transaction wrapper (txDriver) to avoid Commit or Rollback calls
// from the internal builders. Should be called only by the internal builders.
func (tx *txDriver) Tx(context.Context) (dialect.Tx, error) { return tx, nil }

// Dialect returns the dialect of the driver we started the transaction from.
func (tx *txDriver) Dialect() string { return tx.drv.Dialect() }

// Close is a nop close.
func (*txDriver) Close() error { return nil }

// Commit is a nop commit for the internal builders.
// User must call `Tx.Commit` in order to commit the transaction.
func (*txDriver) Commit() error { return nil }

// Rollback is a nop rollback for the internal builders.
// User must call `Tx.Rollback` in order to rollback the transaction.
func (*txDriver) Rollback() error { return nil }

// Exec calls tx.Exec.
func (tx *txDriver) Exec(ctx context.Context, query string, args, v any) error {
	return tx.tx.Exec(ctx, query, args, v)
}

// Query calls tx.Query.
func (tx *txDriver) Query(ctx context.Context, query string, args, v any) error {
	return tx.tx.Query(ctx, query, args, v)
}

var _ dialect.Driver = (*txDriver)(nil)
