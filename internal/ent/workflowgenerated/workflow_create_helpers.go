// Code generated by ent. DO NOT EDIT.
// This file is generated to keep workflow create helpers in sync with ent schemas.
package workflowgenerated

import (
	"context"
	"errors"
	"strings"

	"github.com/go-viper/mapstructure/v2"
	"github.com/theopenlane/core/internal/ent/generated"
)

var (
	ErrNilClient               = errors.New("ent client is required")
	ErrCreateObjectTypeInvalid = errors.New("create object type is invalid")
)

type createObjectEntry struct {
	create func(ctx context.Context, client *generated.Client, fields map[string]any) error
}

var creatableSchemaTypes = map[string]createObjectEntry{
	NormalizeSchemaType("APIToken"):   makeCreateEntry[generated.CreateAPITokenInput](func(client *generated.Client) *generated.APITokenCreate { return client.APIToken.Create() }),
	NormalizeSchemaType("ActionPlan"): makeCreateEntry[generated.CreateActionPlanInput](func(client *generated.Client) *generated.ActionPlanCreate { return client.ActionPlan.Create() }),
	NormalizeSchemaType("Assessment"): makeCreateEntry[generated.CreateAssessmentInput](func(client *generated.Client) *generated.AssessmentCreate { return client.Assessment.Create() }),
	NormalizeSchemaType("AssessmentResponse"): makeCreateEntry[generated.CreateAssessmentResponseInput](func(client *generated.Client) *generated.AssessmentResponseCreate {
		return client.AssessmentResponse.Create()
	}),
	NormalizeSchemaType("Asset"):          makeCreateEntry[generated.CreateAssetInput](func(client *generated.Client) *generated.AssetCreate { return client.Asset.Create() }),
	NormalizeSchemaType("Campaign"):       makeCreateEntry[generated.CreateCampaignInput](func(client *generated.Client) *generated.CampaignCreate { return client.Campaign.Create() }),
	NormalizeSchemaType("CampaignTarget"): makeCreateEntry[generated.CreateCampaignTargetInput](func(client *generated.Client) *generated.CampaignTargetCreate { return client.CampaignTarget.Create() }),
	NormalizeSchemaType("Contact"):        makeCreateEntry[generated.CreateContactInput](func(client *generated.Client) *generated.ContactCreate { return client.Contact.Create() }),
	NormalizeSchemaType("Control"):        makeCreateEntry[generated.CreateControlInput](func(client *generated.Client) *generated.ControlCreate { return client.Control.Create() }),
	NormalizeSchemaType("ControlImplementation"): makeCreateEntry[generated.CreateControlImplementationInput](func(client *generated.Client) *generated.ControlImplementationCreate {
		return client.ControlImplementation.Create()
	}),
	NormalizeSchemaType("ControlObjective"): makeCreateEntry[generated.CreateControlObjectiveInput](func(client *generated.Client) *generated.ControlObjectiveCreate {
		return client.ControlObjective.Create()
	}),
	NormalizeSchemaType("CustomDomain"):   makeCreateEntry[generated.CreateCustomDomainInput](func(client *generated.Client) *generated.CustomDomainCreate { return client.CustomDomain.Create() }),
	NormalizeSchemaType("CustomTypeEnum"): makeCreateEntry[generated.CreateCustomTypeEnumInput](func(client *generated.Client) *generated.CustomTypeEnumCreate { return client.CustomTypeEnum.Create() }),
	NormalizeSchemaType("DNSVerification"): makeCreateEntry[generated.CreateDNSVerificationInput](func(client *generated.Client) *generated.DNSVerificationCreate {
		return client.DNSVerification.Create()
	}),
	NormalizeSchemaType("DirectoryAccount"): makeCreateEntry[generated.CreateDirectoryAccountInput](func(client *generated.Client) *generated.DirectoryAccountCreate {
		return client.DirectoryAccount.Create()
	}),
	NormalizeSchemaType("DirectoryGroup"): makeCreateEntry[generated.CreateDirectoryGroupInput](func(client *generated.Client) *generated.DirectoryGroupCreate { return client.DirectoryGroup.Create() }),
	NormalizeSchemaType("DirectoryMembership"): makeCreateEntry[generated.CreateDirectoryMembershipInput](func(client *generated.Client) *generated.DirectoryMembershipCreate {
		return client.DirectoryMembership.Create()
	}),
	NormalizeSchemaType("DirectorySyncRun"): makeCreateEntry[generated.CreateDirectorySyncRunInput](func(client *generated.Client) *generated.DirectorySyncRunCreate {
		return client.DirectorySyncRun.Create()
	}),
	NormalizeSchemaType("Discussion"):     makeCreateEntry[generated.CreateDiscussionInput](func(client *generated.Client) *generated.DiscussionCreate { return client.Discussion.Create() }),
	NormalizeSchemaType("DocumentData"):   makeCreateEntry[generated.CreateDocumentDataInput](func(client *generated.Client) *generated.DocumentDataCreate { return client.DocumentData.Create() }),
	NormalizeSchemaType("EmailBranding"):  makeCreateEntry[generated.CreateEmailBrandingInput](func(client *generated.Client) *generated.EmailBrandingCreate { return client.EmailBranding.Create() }),
	NormalizeSchemaType("EmailTemplate"):  makeCreateEntry[generated.CreateEmailTemplateInput](func(client *generated.Client) *generated.EmailTemplateCreate { return client.EmailTemplate.Create() }),
	NormalizeSchemaType("Entity"):         makeCreateEntry[generated.CreateEntityInput](func(client *generated.Client) *generated.EntityCreate { return client.Entity.Create() }),
	NormalizeSchemaType("EntityType"):     makeCreateEntry[generated.CreateEntityTypeInput](func(client *generated.Client) *generated.EntityTypeCreate { return client.EntityType.Create() }),
	NormalizeSchemaType("Event"):          makeCreateEntry[generated.CreateEventInput](func(client *generated.Client) *generated.EventCreate { return client.Event.Create() }),
	NormalizeSchemaType("Evidence"):       makeCreateEntry[generated.CreateEvidenceInput](func(client *generated.Client) *generated.EvidenceCreate { return client.Evidence.Create() }),
	NormalizeSchemaType("Export"):         makeCreateEntry[generated.CreateExportInput](func(client *generated.Client) *generated.ExportCreate { return client.Export.Create() }),
	NormalizeSchemaType("File"):           makeCreateEntry[generated.CreateFileInput](func(client *generated.Client) *generated.FileCreate { return client.File.Create() }),
	NormalizeSchemaType("Finding"):        makeCreateEntry[generated.CreateFindingInput](func(client *generated.Client) *generated.FindingCreate { return client.Finding.Create() }),
	NormalizeSchemaType("FindingControl"): makeCreateEntry[generated.CreateFindingControlInput](func(client *generated.Client) *generated.FindingControlCreate { return client.FindingControl.Create() }),
	NormalizeSchemaType("Group"):          makeCreateEntry[generated.CreateGroupInput](func(client *generated.Client) *generated.GroupCreate { return client.Group.Create() }),
	NormalizeSchemaType("GroupMembership"): makeCreateEntry[generated.CreateGroupMembershipInput](func(client *generated.Client) *generated.GroupMembershipCreate {
		return client.GroupMembership.Create()
	}),
	NormalizeSchemaType("GroupSetting"):   makeCreateEntry[generated.CreateGroupSettingInput](func(client *generated.Client) *generated.GroupSettingCreate { return client.GroupSetting.Create() }),
	NormalizeSchemaType("Hush"):           makeCreateEntry[generated.CreateHushInput](func(client *generated.Client) *generated.HushCreate { return client.Hush.Create() }),
	NormalizeSchemaType("IdentityHolder"): makeCreateEntry[generated.CreateIdentityHolderInput](func(client *generated.Client) *generated.IdentityHolderCreate { return client.IdentityHolder.Create() }),
	NormalizeSchemaType("InternalPolicy"): makeCreateEntry[generated.CreateInternalPolicyInput](func(client *generated.Client) *generated.InternalPolicyCreate { return client.InternalPolicy.Create() }),
	NormalizeSchemaType("Invite"):         makeCreateEntry[generated.CreateInviteInput](func(client *generated.Client) *generated.InviteCreate { return client.Invite.Create() }),
	NormalizeSchemaType("JobResult"):      makeCreateEntry[generated.CreateJobResultInput](func(client *generated.Client) *generated.JobResultCreate { return client.JobResult.Create() }),
	NormalizeSchemaType("JobRunner"):      makeCreateEntry[generated.CreateJobRunnerInput](func(client *generated.Client) *generated.JobRunnerCreate { return client.JobRunner.Create() }),
	NormalizeSchemaType("JobRunnerRegistrationToken"): makeCreateEntry[generated.CreateJobRunnerRegistrationTokenInput](func(client *generated.Client) *generated.JobRunnerRegistrationTokenCreate {
		return client.JobRunnerRegistrationToken.Create()
	}),
	NormalizeSchemaType("JobRunnerToken"): makeCreateEntry[generated.CreateJobRunnerTokenInput](func(client *generated.Client) *generated.JobRunnerTokenCreate { return client.JobRunnerToken.Create() }),
	NormalizeSchemaType("JobTemplate"):    makeCreateEntry[generated.CreateJobTemplateInput](func(client *generated.Client) *generated.JobTemplateCreate { return client.JobTemplate.Create() }),
	NormalizeSchemaType("MappableDomain"): makeCreateEntry[generated.CreateMappableDomainInput](func(client *generated.Client) *generated.MappableDomainCreate { return client.MappableDomain.Create() }),
	NormalizeSchemaType("MappedControl"):  makeCreateEntry[generated.CreateMappedControlInput](func(client *generated.Client) *generated.MappedControlCreate { return client.MappedControl.Create() }),
	NormalizeSchemaType("Narrative"):      makeCreateEntry[generated.CreateNarrativeInput](func(client *generated.Client) *generated.NarrativeCreate { return client.Narrative.Create() }),
	NormalizeSchemaType("Note"):           makeCreateEntry[generated.CreateNoteInput](func(client *generated.Client) *generated.NoteCreate { return client.Note.Create() }),
	NormalizeSchemaType("Notification"):   makeCreateEntry[generated.CreateNotificationInput](func(client *generated.Client) *generated.NotificationCreate { return client.Notification.Create() }),
	NormalizeSchemaType("NotificationPreference"): makeCreateEntry[generated.CreateNotificationPreferenceInput](func(client *generated.Client) *generated.NotificationPreferenceCreate {
		return client.NotificationPreference.Create()
	}),
	NormalizeSchemaType("NotificationTemplate"): makeCreateEntry[generated.CreateNotificationTemplateInput](func(client *generated.Client) *generated.NotificationTemplateCreate {
		return client.NotificationTemplate.Create()
	}),
	NormalizeSchemaType("Onboarding"):    makeCreateEntry[generated.CreateOnboardingInput](func(client *generated.Client) *generated.OnboardingCreate { return client.Onboarding.Create() }),
	NormalizeSchemaType("OrgMembership"): makeCreateEntry[generated.CreateOrgMembershipInput](func(client *generated.Client) *generated.OrgMembershipCreate { return client.OrgMembership.Create() }),
	NormalizeSchemaType("Organization"):  makeCreateEntry[generated.CreateOrganizationInput](func(client *generated.Client) *generated.OrganizationCreate { return client.Organization.Create() }),
	NormalizeSchemaType("OrganizationSetting"): makeCreateEntry[generated.CreateOrganizationSettingInput](func(client *generated.Client) *generated.OrganizationSettingCreate {
		return client.OrganizationSetting.Create()
	}),
	NormalizeSchemaType("PersonalAccessToken"): makeCreateEntry[generated.CreatePersonalAccessTokenInput](func(client *generated.Client) *generated.PersonalAccessTokenCreate {
		return client.PersonalAccessToken.Create()
	}),
	NormalizeSchemaType("Platform"):  makeCreateEntry[generated.CreatePlatformInput](func(client *generated.Client) *generated.PlatformCreate { return client.Platform.Create() }),
	NormalizeSchemaType("Procedure"): makeCreateEntry[generated.CreateProcedureInput](func(client *generated.Client) *generated.ProcedureCreate { return client.Procedure.Create() }),
	NormalizeSchemaType("Program"):   makeCreateEntry[generated.CreateProgramInput](func(client *generated.Client) *generated.ProgramCreate { return client.Program.Create() }),
	NormalizeSchemaType("ProgramMembership"): makeCreateEntry[generated.CreateProgramMembershipInput](func(client *generated.Client) *generated.ProgramMembershipCreate {
		return client.ProgramMembership.Create()
	}),
	NormalizeSchemaType("Remediation"):  makeCreateEntry[generated.CreateRemediationInput](func(client *generated.Client) *generated.RemediationCreate { return client.Remediation.Create() }),
	NormalizeSchemaType("Review"):       makeCreateEntry[generated.CreateReviewInput](func(client *generated.Client) *generated.ReviewCreate { return client.Review.Create() }),
	NormalizeSchemaType("Risk"):         makeCreateEntry[generated.CreateRiskInput](func(client *generated.Client) *generated.RiskCreate { return client.Risk.Create() }),
	NormalizeSchemaType("Scan"):         makeCreateEntry[generated.CreateScanInput](func(client *generated.Client) *generated.ScanCreate { return client.Scan.Create() }),
	NormalizeSchemaType("ScheduledJob"): makeCreateEntry[generated.CreateScheduledJobInput](func(client *generated.Client) *generated.ScheduledJobCreate { return client.ScheduledJob.Create() }),
	NormalizeSchemaType("ScheduledJobRun"): makeCreateEntry[generated.CreateScheduledJobRunInput](func(client *generated.Client) *generated.ScheduledJobRunCreate {
		return client.ScheduledJobRun.Create()
	}),
	NormalizeSchemaType("Standard"):      makeCreateEntry[generated.CreateStandardInput](func(client *generated.Client) *generated.StandardCreate { return client.Standard.Create() }),
	NormalizeSchemaType("Subcontrol"):    makeCreateEntry[generated.CreateSubcontrolInput](func(client *generated.Client) *generated.SubcontrolCreate { return client.Subcontrol.Create() }),
	NormalizeSchemaType("Subprocessor"):  makeCreateEntry[generated.CreateSubprocessorInput](func(client *generated.Client) *generated.SubprocessorCreate { return client.Subprocessor.Create() }),
	NormalizeSchemaType("Subscriber"):    makeCreateEntry[generated.CreateSubscriberInput](func(client *generated.Client) *generated.SubscriberCreate { return client.Subscriber.Create() }),
	NormalizeSchemaType("TFASetting"):    makeCreateEntry[generated.CreateTFASettingInput](func(client *generated.Client) *generated.TFASettingCreate { return client.TFASetting.Create() }),
	NormalizeSchemaType("TagDefinition"): makeCreateEntry[generated.CreateTagDefinitionInput](func(client *generated.Client) *generated.TagDefinitionCreate { return client.TagDefinition.Create() }),
	NormalizeSchemaType("Task"):          makeCreateEntry[generated.CreateTaskInput](func(client *generated.Client) *generated.TaskCreate { return client.Task.Create() }),
	NormalizeSchemaType("Template"):      makeCreateEntry[generated.CreateTemplateInput](func(client *generated.Client) *generated.TemplateCreate { return client.Template.Create() }),
	NormalizeSchemaType("TrustCenter"):   makeCreateEntry[generated.CreateTrustCenterInput](func(client *generated.Client) *generated.TrustCenterCreate { return client.TrustCenter.Create() }),
	NormalizeSchemaType("TrustCenterCompliance"): makeCreateEntry[generated.CreateTrustCenterComplianceInput](func(client *generated.Client) *generated.TrustCenterComplianceCreate {
		return client.TrustCenterCompliance.Create()
	}),
	NormalizeSchemaType("TrustCenterDoc"): makeCreateEntry[generated.CreateTrustCenterDocInput](func(client *generated.Client) *generated.TrustCenterDocCreate { return client.TrustCenterDoc.Create() }),
	NormalizeSchemaType("TrustCenterEntity"): makeCreateEntry[generated.CreateTrustCenterEntityInput](func(client *generated.Client) *generated.TrustCenterEntityCreate {
		return client.TrustCenterEntity.Create()
	}),
	NormalizeSchemaType("TrustCenterFAQ"): makeCreateEntry[generated.CreateTrustCenterFAQInput](func(client *generated.Client) *generated.TrustCenterFAQCreate { return client.TrustCenterFAQ.Create() }),
	NormalizeSchemaType("TrustCenterNDARequest"): makeCreateEntry[generated.CreateTrustCenterNDARequestInput](func(client *generated.Client) *generated.TrustCenterNDARequestCreate {
		return client.TrustCenterNDARequest.Create()
	}),
	NormalizeSchemaType("TrustCenterSetting"): makeCreateEntry[generated.CreateTrustCenterSettingInput](func(client *generated.Client) *generated.TrustCenterSettingCreate {
		return client.TrustCenterSetting.Create()
	}),
	NormalizeSchemaType("TrustCenterSubprocessor"): makeCreateEntry[generated.CreateTrustCenterSubprocessorInput](func(client *generated.Client) *generated.TrustCenterSubprocessorCreate {
		return client.TrustCenterSubprocessor.Create()
	}),
	NormalizeSchemaType("TrustCenterWatermarkConfig"): makeCreateEntry[generated.CreateTrustCenterWatermarkConfigInput](func(client *generated.Client) *generated.TrustCenterWatermarkConfigCreate {
		return client.TrustCenterWatermarkConfig.Create()
	}),
	NormalizeSchemaType("User"):          makeCreateEntry[generated.CreateUserInput](func(client *generated.Client) *generated.UserCreate { return client.User.Create() }),
	NormalizeSchemaType("UserSetting"):   makeCreateEntry[generated.CreateUserSettingInput](func(client *generated.Client) *generated.UserSettingCreate { return client.UserSetting.Create() }),
	NormalizeSchemaType("Vulnerability"): makeCreateEntry[generated.CreateVulnerabilityInput](func(client *generated.Client) *generated.VulnerabilityCreate { return client.Vulnerability.Create() }),
	NormalizeSchemaType("WorkflowDefinition"): makeCreateEntry[generated.CreateWorkflowDefinitionInput](func(client *generated.Client) *generated.WorkflowDefinitionCreate {
		return client.WorkflowDefinition.Create()
	}),
}

// NormalizeSchemaType returns a normalized schema identifier for matching.
func NormalizeSchemaType(value string) string {
	if value == "" {
		return ""
	}

	normalized := strings.ToLower(value)
	normalized = strings.ReplaceAll(normalized, "_", "")
	normalized = strings.ReplaceAll(normalized, "-", "")
	normalized = strings.ReplaceAll(normalized, " ", "")

	return normalized
}

// IsCreatableSchemaType reports whether the schema type maps to a creatable ent client.
func IsCreatableSchemaType(schemaType string) bool {
	if schemaType == "" {
		return false
	}

	_, ok := creatableSchemaTypes[NormalizeSchemaType(schemaType)]
	return ok
}

// CreateObject builds and executes a create mutation for the provided schema type.
func CreateObject(ctx context.Context, client *generated.Client, schemaType string, fields map[string]any) error {
	if client == nil {
		return ErrNilClient
	}

	entry, ok := creatableSchemaTypes[NormalizeSchemaType(schemaType)]
	if !ok {
		return ErrCreateObjectTypeInvalid
	}

	return entry.create(ctx, client, fields)
}

func makeCreateEntry[I any, B interface {
	SetInput(I) B
	Exec(context.Context) error
}](builder func(client *generated.Client) B) createObjectEntry {
	return createObjectEntry{
		create: func(ctx context.Context, client *generated.Client, fields map[string]any) error {
			input, err := decodeCreateInput[I](fields)
			if err != nil {
				return err
			}

			return builder(client).SetInput(input).Exec(ctx)
		},
	}
}

func decodeCreateInput[I any](fields map[string]any) (I, error) {
	var input I
	if len(fields) == 0 {
		return input, nil
	}

	decoder, err := mapstructure.NewDecoder(&mapstructure.DecoderConfig{
		Result:           &input,
		WeaklyTypedInput: true,
		TagName:          "json",
		MatchName: func(mapKey, fieldName string) bool {
			return NormalizeSchemaType(mapKey) == NormalizeSchemaType(fieldName)
		},
		DecodeHook: mapstructure.ComposeDecodeHookFunc(
			mapstructure.StringToTimeDurationHookFunc(),
			mapstructure.TextUnmarshallerHookFunc(),
		),
	})
	if err != nil {
		return input, err
	}

	if err := decoder.Decode(fields); err != nil {
		return input, err
	}

	return input, nil
}
