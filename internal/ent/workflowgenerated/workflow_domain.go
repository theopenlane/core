// Code generated by ent. DO NOT EDIT.
// This file is generated to provide type-safe workflow domains for approval scopes.
package workflowgenerated

import (
	"fmt"
	"sort"
	"strings"

	"github.com/theopenlane/core/common/enums"
	"github.com/theopenlane/core/internal/workflows"
)

// WorkflowDomain represents a canonical approval domain for workflow proposals.
// A domain is the combination of an object type and the fields requiring approval.
type WorkflowDomain struct {
	// ObjectType is the workflow object type this domain applies to
	ObjectType enums.WorkflowObjectType
	// Fields is the sorted list of field names in this domain
	Fields []string
}

// Key returns the canonical domain key including object type prefix.
// Format: "ObjectType:field1,field2,field3" (fields are sorted).
func (d WorkflowDomain) Key() string {
	if len(d.Fields) == 0 {
		return string(d.ObjectType)
	}
	fields := make([]string, len(d.Fields))
	copy(fields, d.Fields)
	sort.Strings(fields)
	return string(d.ObjectType) + ":" + strings.Join(fields, ",")
}

// String implements fmt.Stringer
func (d WorkflowDomain) String() string {
	return d.Key()
}

// Equals returns true if two domains have the same object type and fields
func (d WorkflowDomain) Equals(other WorkflowDomain) bool {
	return d.Key() == other.Key()
}

// Contains returns true if this domain contains all fields of the other domain
func (d WorkflowDomain) Contains(other WorkflowDomain) bool {
	if d.ObjectType != other.ObjectType {
		return false
	}
	fieldSet := make(map[string]struct{}, len(d.Fields))
	for _, f := range d.Fields {
		fieldSet[f] = struct{}{}
	}
	for _, f := range other.Fields {
		if _, ok := fieldSet[f]; !ok {
			return false
		}
	}
	return true
}

// Single-field domain constants for each workflow-eligible field
var (
	// DomainActionPlanWorkflowEligibleMarker is the approval domain for ActionPlan.workflow_eligible_marker
	DomainActionPlanWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeActionPlan,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainCampaignWorkflowEligibleMarker is the approval domain for Campaign.workflow_eligible_marker
	DomainCampaignWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainCampaignStatus is the approval domain for Campaign.status
	DomainCampaignStatus = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"status"},
	}
	// DomainCampaignIsActive is the approval domain for Campaign.is_active
	DomainCampaignIsActive = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"is_active"},
	}
	// DomainCampaignScheduledAt is the approval domain for Campaign.scheduled_at
	DomainCampaignScheduledAt = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"scheduled_at"},
	}
	// DomainCampaignDueDate is the approval domain for Campaign.due_date
	DomainCampaignDueDate = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"due_date"},
	}
	// DomainCampaignIsRecurring is the approval domain for Campaign.is_recurring
	DomainCampaignIsRecurring = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"is_recurring"},
	}
	// DomainCampaignRecurrenceFrequency is the approval domain for Campaign.recurrence_frequency
	DomainCampaignRecurrenceFrequency = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"recurrence_frequency"},
	}
	// DomainCampaignRecipientCount is the approval domain for Campaign.recipient_count
	DomainCampaignRecipientCount = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"recipient_count"},
	}
	// DomainCampaignResendCount is the approval domain for Campaign.resend_count
	DomainCampaignResendCount = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaign,
		Fields:     []string{"resend_count"},
	}
	// DomainCampaignTargetWorkflowEligibleMarker is the approval domain for CampaignTarget.workflow_eligible_marker
	DomainCampaignTargetWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaignTarget,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainCampaignTargetStatus is the approval domain for CampaignTarget.status
	DomainCampaignTargetStatus = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaignTarget,
		Fields:     []string{"status"},
	}
	// DomainCampaignTargetSentAt is the approval domain for CampaignTarget.sent_at
	DomainCampaignTargetSentAt = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaignTarget,
		Fields:     []string{"sent_at"},
	}
	// DomainCampaignTargetCompletedAt is the approval domain for CampaignTarget.completed_at
	DomainCampaignTargetCompletedAt = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeCampaignTarget,
		Fields:     []string{"completed_at"},
	}
	// DomainControlTitle is the approval domain for Control.title
	DomainControlTitle = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"title"},
	}
	// DomainControlReferenceID is the approval domain for Control.reference_id
	DomainControlReferenceID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"reference_id"},
	}
	// DomainControlAuditorReferenceID is the approval domain for Control.auditor_reference_id
	DomainControlAuditorReferenceID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"auditor_reference_id"},
	}
	// DomainControlResponsiblePartyID is the approval domain for Control.responsible_party_id
	DomainControlResponsiblePartyID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"responsible_party_id"},
	}
	// DomainControlStatus is the approval domain for Control.status
	DomainControlStatus = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"status"},
	}
	// DomainControlReferenceFramework is the approval domain for Control.reference_framework
	DomainControlReferenceFramework = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"reference_framework"},
	}
	// DomainControlReferenceFrameworkRevision is the approval domain for Control.reference_framework_revision
	DomainControlReferenceFrameworkRevision = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"reference_framework_revision"},
	}
	// DomainControlCategory is the approval domain for Control.category
	DomainControlCategory = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"category"},
	}
	// DomainControlCategoryID is the approval domain for Control.category_id
	DomainControlCategoryID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"category_id"},
	}
	// DomainControlSubcategory is the approval domain for Control.subcategory
	DomainControlSubcategory = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"subcategory"},
	}
	// DomainControlControlOwnerID is the approval domain for Control.control_owner_id
	DomainControlControlOwnerID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"control_owner_id"},
	}
	// DomainControlWorkflowEligibleMarker is the approval domain for Control.workflow_eligible_marker
	DomainControlWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeControl,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainEvidenceWorkflowEligibleMarker is the approval domain for Evidence.workflow_eligible_marker
	DomainEvidenceWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeEvidence,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainIdentityHolderWorkflowEligibleMarker is the approval domain for IdentityHolder.workflow_eligible_marker
	DomainIdentityHolderWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeIdentityHolder,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainIdentityHolderStatus is the approval domain for IdentityHolder.status
	DomainIdentityHolderStatus = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeIdentityHolder,
		Fields:     []string{"status"},
	}
	// DomainIdentityHolderIsActive is the approval domain for IdentityHolder.is_active
	DomainIdentityHolderIsActive = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeIdentityHolder,
		Fields:     []string{"is_active"},
	}
	// DomainIdentityHolderStartDate is the approval domain for IdentityHolder.start_date
	DomainIdentityHolderStartDate = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeIdentityHolder,
		Fields:     []string{"start_date"},
	}
	// DomainIdentityHolderEndDate is the approval domain for IdentityHolder.end_date
	DomainIdentityHolderEndDate = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeIdentityHolder,
		Fields:     []string{"end_date"},
	}
	// DomainInternalPolicyWorkflowEligibleMarker is the approval domain for InternalPolicy.workflow_eligible_marker
	DomainInternalPolicyWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeInternalPolicy,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainPlatformWorkflowEligibleMarker is the approval domain for Platform.workflow_eligible_marker
	DomainPlatformWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypePlatform,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainPlatformBusinessPurpose is the approval domain for Platform.business_purpose
	DomainPlatformBusinessPurpose = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypePlatform,
		Fields:     []string{"business_purpose"},
	}
	// DomainPlatformScopeStatement is the approval domain for Platform.scope_statement
	DomainPlatformScopeStatement = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypePlatform,
		Fields:     []string{"scope_statement"},
	}
	// DomainPlatformStatus is the approval domain for Platform.status
	DomainPlatformStatus = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypePlatform,
		Fields:     []string{"status"},
	}
	// DomainPlatformContainsPii is the approval domain for Platform.contains_pii
	DomainPlatformContainsPii = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypePlatform,
		Fields:     []string{"contains_pii"},
	}
	// DomainProcedureWorkflowEligibleMarker is the approval domain for Procedure.workflow_eligible_marker
	DomainProcedureWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeProcedure,
		Fields:     []string{"workflow_eligible_marker"},
	}
	// DomainSubcontrolTitle is the approval domain for Subcontrol.title
	DomainSubcontrolTitle = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"title"},
	}
	// DomainSubcontrolReferenceID is the approval domain for Subcontrol.reference_id
	DomainSubcontrolReferenceID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"reference_id"},
	}
	// DomainSubcontrolAuditorReferenceID is the approval domain for Subcontrol.auditor_reference_id
	DomainSubcontrolAuditorReferenceID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"auditor_reference_id"},
	}
	// DomainSubcontrolResponsiblePartyID is the approval domain for Subcontrol.responsible_party_id
	DomainSubcontrolResponsiblePartyID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"responsible_party_id"},
	}
	// DomainSubcontrolStatus is the approval domain for Subcontrol.status
	DomainSubcontrolStatus = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"status"},
	}
	// DomainSubcontrolReferenceFramework is the approval domain for Subcontrol.reference_framework
	DomainSubcontrolReferenceFramework = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"reference_framework"},
	}
	// DomainSubcontrolReferenceFrameworkRevision is the approval domain for Subcontrol.reference_framework_revision
	DomainSubcontrolReferenceFrameworkRevision = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"reference_framework_revision"},
	}
	// DomainSubcontrolCategory is the approval domain for Subcontrol.category
	DomainSubcontrolCategory = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"category"},
	}
	// DomainSubcontrolCategoryID is the approval domain for Subcontrol.category_id
	DomainSubcontrolCategoryID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"category_id"},
	}
	// DomainSubcontrolSubcategory is the approval domain for Subcontrol.subcategory
	DomainSubcontrolSubcategory = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"subcategory"},
	}
	// DomainSubcontrolControlOwnerID is the approval domain for Subcontrol.control_owner_id
	DomainSubcontrolControlOwnerID = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"control_owner_id"},
	}
	// DomainSubcontrolWorkflowEligibleMarker is the approval domain for Subcontrol.workflow_eligible_marker
	DomainSubcontrolWorkflowEligibleMarker = WorkflowDomain{
		ObjectType: enums.WorkflowObjectTypeSubcontrol,
		Fields:     []string{"workflow_eligible_marker"},
	}
)

// WorkflowEligibleFields maps object types to their workflow-eligible field names.
// Use this to validate that fields in a domain are valid for the object type.
var WorkflowEligibleFields = map[enums.WorkflowObjectType]map[string]struct{}{
	enums.WorkflowObjectTypeActionPlan: {
		"workflow_eligible_marker": {},
	},
	enums.WorkflowObjectTypeCampaign: {
		"workflow_eligible_marker": {},
		"status":                   {},
		"is_active":                {},
		"scheduled_at":             {},
		"due_date":                 {},
		"is_recurring":             {},
		"recurrence_frequency":     {},
		"recipient_count":          {},
		"resend_count":             {},
	},
	enums.WorkflowObjectTypeCampaignTarget: {
		"workflow_eligible_marker": {},
		"status":                   {},
		"sent_at":                  {},
		"completed_at":             {},
	},
	enums.WorkflowObjectTypeControl: {
		"title":                        {},
		"reference_id":                 {},
		"auditor_reference_id":         {},
		"responsible_party_id":         {},
		"status":                       {},
		"reference_framework":          {},
		"reference_framework_revision": {},
		"category":                     {},
		"category_id":                  {},
		"subcategory":                  {},
		"control_owner_id":             {},
		"workflow_eligible_marker":     {},
	},
	enums.WorkflowObjectTypeEvidence: {
		"workflow_eligible_marker": {},
	},
	enums.WorkflowObjectTypeIdentityHolder: {
		"workflow_eligible_marker": {},
		"status":                   {},
		"is_active":                {},
		"start_date":               {},
		"end_date":                 {},
	},
	enums.WorkflowObjectTypeInternalPolicy: {
		"workflow_eligible_marker": {},
	},
	enums.WorkflowObjectTypePlatform: {
		"workflow_eligible_marker": {},
		"business_purpose":         {},
		"scope_statement":          {},
		"status":                   {},
		"contains_pii":             {},
	},
	enums.WorkflowObjectTypeProcedure: {
		"workflow_eligible_marker": {},
	},
	enums.WorkflowObjectTypeSubcontrol: {
		"title":                        {},
		"reference_id":                 {},
		"auditor_reference_id":         {},
		"responsible_party_id":         {},
		"status":                       {},
		"reference_framework":          {},
		"reference_framework_revision": {},
		"category":                     {},
		"category_id":                  {},
		"subcategory":                  {},
		"control_owner_id":             {},
		"workflow_eligible_marker":     {},
	},
}

// ErrInvalidObjectType is returned when an object type is not workflow-eligible
var ErrInvalidObjectType = fmt.Errorf("object type is not workflow-eligible")

// ErrInvalidDomainField is returned when a field is not workflow-eligible for the object type
var ErrInvalidDomainField = fmt.Errorf("field is not workflow-eligible for object type")

// ErrEmptyDomainFields is returned when no fields are provided for a domain
var ErrEmptyDomainFields = fmt.Errorf("domain requires at least one field")

// NewWorkflowDomain creates a validated domain for an object type and fields.
// Fields are automatically sorted to ensure canonical ordering.
// Returns an error if the object type or any field is not workflow-eligible.
func NewWorkflowDomain(objectType enums.WorkflowObjectType, fields []string) (WorkflowDomain, error) {
	if len(fields) == 0 {
		return WorkflowDomain{}, ErrEmptyDomainFields
	}

	eligible, ok := WorkflowEligibleFields[objectType]
	if !ok {
		return WorkflowDomain{}, fmt.Errorf("%w: %s", ErrInvalidObjectType, objectType)
	}

	sorted := make([]string, len(fields))
	copy(sorted, fields)
	sort.Strings(sorted)

	for _, field := range sorted {
		if _, ok := eligible[field]; !ok {
			return WorkflowDomain{}, fmt.Errorf("%w: %s.%s", ErrInvalidDomainField, objectType, field)
		}
	}

	return WorkflowDomain{
		ObjectType: objectType,
		Fields:     sorted,
	}, nil
}

// MustNewWorkflowDomain creates a validated domain and panics if validation fails.
// Use this for compile-time constant domains where validation errors indicate programmer error.
func MustNewWorkflowDomain(objectType enums.WorkflowObjectType, fields []string) WorkflowDomain {
	domain, err := NewWorkflowDomain(objectType, fields)
	if err != nil {
		panic(err)
	}
	return domain
}

// ValidateDomainFields checks that all fields are workflow-eligible for the object type.
// Returns nil if valid, or an error describing the first invalid field.
func ValidateDomainFields(objectType enums.WorkflowObjectType, fields []string) error {
	_, err := NewWorkflowDomain(objectType, fields)
	return err
}

// ParseDomainKey parses a domain key string back into a WorkflowDomain.
// Expected format: "ObjectType:field1,field2" or "ObjectType" for empty fields.
func ParseDomainKey(key string) (WorkflowDomain, error) {
	if key == "" {
		return WorkflowDomain{}, fmt.Errorf("empty domain key")
	}

	parts := strings.SplitN(key, ":", 2)
	objectType := enums.ToWorkflowObjectType(parts[0])
	if objectType == nil {
		return WorkflowDomain{}, fmt.Errorf("%w: %s", ErrInvalidObjectType, parts[0])
	}

	if len(parts) == 1 || parts[1] == "" {
		return WorkflowDomain{ObjectType: *objectType}, nil
	}

	fields := strings.Split(parts[1], ",")
	return NewWorkflowDomain(*objectType, fields)
}

// GetEligibleFields returns the workflow-eligible fields for an object type.
// Returns nil if the object type is not workflow-eligible.
func GetEligibleFields(objectType enums.WorkflowObjectType) []string {
	eligible, ok := WorkflowEligibleFields[objectType]
	if !ok {
		return nil
	}
	fields := make([]string, 0, len(eligible))
	for field := range eligible {
		fields = append(fields, field)
	}
	sort.Strings(fields)
	return fields
}

// IsWorkflowEligible returns true if the object type has workflow-eligible fields
func IsWorkflowEligible(objectType enums.WorkflowObjectType) bool {
	_, ok := WorkflowEligibleFields[objectType]
	return ok
}

// IsFieldEligible returns true if the field is workflow-eligible for the object type
func IsFieldEligible(objectType enums.WorkflowObjectType, field string) bool {
	eligible, ok := WorkflowEligibleFields[objectType]
	if !ok {
		return false
	}
	_, ok = eligible[field]
	return ok
}

func init() {
	// Ensure workflow-eligible fields are available to approval routing helpers.
	workflows.RegisterEligibleFields(WorkflowEligibleFields)
}
