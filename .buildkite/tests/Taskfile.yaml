version: "3"

vars:
  BATSTESTS:
    sh: ls .buildkite/tests/*.bats

tasks:
  default:
    silent: true
    cmds:
      - task --list

  test:
    desc: Install dependencies
    silent: true
    cmds:
      - echo "Running bats tests"
      - for: {var: BATSTESTS, as: BATS}
        cmd: bats {{.BATS}}
      - echo "running test for load_template"
      - bash .buildkite/tests/load_template_test.sh

    preconditions:
      - which bats
